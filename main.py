import telebotimport sqlite3from telebot import typesfrom get_price import get_priceTOKEN = "1375970362:AAE8ZdZHn46q-R3lfQnZHsCJ3_GmL5-hpeE"bot = telebot.TeleBot(TOKEN)# connection = sqlite3.connect("person.db")# cursor = connection.cursor()# cursor.execute("CREATE TABLE IF NOT EXISTS info (id int, name text)")# cursor.close()# connection.close()def get(message):    connection = sqlite3.connect("person.dp")    cursor = connection.cursor()    cursor.execute("CREATE TABLE IF NOT EXISTS info (id int, name text)")    cursor.execute("SELECT id, name FROM info WHERE id = ?", (message.chat.id,))    exist = cursor.fetchone()    cursor.close()    connection.close()    return exist@bot.message_handler(commands=['start'])def start(message):    print('User {id} press start'.format(id=message.chat.id))    exist = get(message)    if exist:        bot.send_message(message.chat.id, 'You are already registered.')    else:        sent = bot.send_message(message.chat.id, 'What is your name?')        bot.register_next_step_handler(sent, hello)def hello(message):    connection = sqlite3.connect("person.dp")    info = message.chat.id, message.text    cursor = connection.cursor()    cursor.execute("CREATE TABLE IF NOT EXISTS info (id int, name text)")    cursor.execute("INSERT INTO info VALUES (?, ?)", info)    print("New user: {name}".format(name=message.text))    bot.send_message(message.chat.id, 'Hello, {name}. I am glad to see you.'.format(name=message.text))    connection.commit()    cursor.close()    connection.close()@bot.message_handler(commands=['help'])def help(message):    print('User {id} press help'.format(id=message.chat.id))    bot.send_message(message.chat.id, helps())def helps():    ans = '/start - registration\n'    ans += '/help - output of all commands\n'    ans += '/settings - edit profile'    return ans@bot.message_handler(commands=['settings'])def settings(message):    print('User {id} press settings'.format(id=message.chat.id))    exist = get(message)    if exist:        keyboard = types.InlineKeyboardMarkup()        callback_button = types.InlineKeyboardButton(text="Изменить Имя", callback_data="update_name")        keyboard.add(callback_button)        bot.send_message(message.chat.id, 'Your name: {name}'.format(name=exist[1]), reply_markup=keyboard)    else:        bot.send_message(message.chat.id, 'I do not know you, please register')@bot.message_handler(regexp="Hello")def handler_message(message):    print('User {id} write {text}'.format(id=message.chat.id, text=message.text))    exist = get(message)    if exist:        bot.send_message(message.chat.id, 'Hello, {name}. I am glad to see you.'.format(name=exist[1]))    else:        bot.send_message(message.chat.id, 'I do not know you, please register')@bot.message_handler(commands=['get_users'])def get_users(message):    print('User {id} want show'.format(id=message.chat.id))    if message.chat.id == 334396592:        output = ''        connection = sqlite3.connect("person.dp")        cursor = connection.cursor()        cursor.execute("SELECT * FROM info")        while True:            row = cursor.fetchone()            if row == None:                break            output += '{one} - {two}'.format(one=row[0], two=row[1]) + '\n'        bot.send_message(message.chat.id, output)        cursor.close()        connection.close()    else:        bot.send_message(message.chat.id, 'You are not an admin')@bot.callback_query_handler(func=lambda call: True)def callback_inline(call):    if call.data == "update_name":        sent = bot.send_message(call.message.chat.id, 'Enter a new name?')        bot.register_next_step_handler(sent, update_name)def update_name(message):    connection = sqlite3.connect("person.dp")    cursor = connection.cursor()    exist = get(message)    cursor.execute("UPDATE info SET name = ? WHERE id = ?", (message.text, message.chat.id))    print('{old} name changed : {name}'.format(old=exist[1], name=message.text))    bot.send_message(message.chat.id, 'Name changed!')    connection.commit()    cursor.close()    connection.close()@bot.message_handler(commands=['get_price'])def get_url(message):    sent = bot.send_message(message.chat.id, 'Введите ссылку')    bot.register_next_step_handler(sent, price)def price(message):    bot.send_message(message.chat.id, "Это займет меньше 2 минут")    bot.send_message(message.chat.id, get_price(message.text))# @bot.message_handler(commands=['add_product'])# def add(message):#     get_url(message)@bot.message_handler(regexp='')def handler_message(message):    print('User {id} write {text}'.format(id=message.chat.id, text=message.text))    bot.send_message(message.chat.id, 'I do not understand you')bot.polling()