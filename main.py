import telebotimport sqlite3TOKEN = "1375970362:AAE8ZdZHn46q-R3lfQnZHsCJ3_GmL5-hpeE"bot = telebot.TeleBot(TOKEN)# connection = sqlite3.connect("person.db")# cursor = connection.cursor()# cursor.execute("CREATE TABLE IF NOT EXISTS info (id int, name text)")# cursor.close()# connection.close()@bot.message_handler(commands=['start'])def start(message):    print('User {id} press start'.format(id=message.chat.id))    connection = sqlite3.connect("person.dp")    cursor = connection.cursor()    cursor.execute("CREATE TABLE IF NOT EXISTS info (id int, name text)")    cursor.execute("SELECT id, name FROM info WHERE id = ?", (message.chat.id,))    exist = cursor.fetchone()    cursor.close()    connection.close()    if exist:        bot.send_message(message.chat.id, 'You are already registered.')    else:        sent = bot.send_message(message.chat.id, 'What is your name?')        bot.register_next_step_handler(sent, hello)def hello(message):    global name    connection = sqlite3.connect("person.dp")    name[message.chat.id] = message.text    info = message.chat.id, message.text    cursor = connection.cursor()    cursor.execute("CREATE TABLE IF NOT EXISTS info (id int, name text)")    cursor.execute("INSERT INTO info VALUES (?, ?)", info)    print("New user: {name}".format(name=message.text))    bot.send_message(message.chat.id, 'Hello, {name}. I am glad to see you.'.format(name=message.text))    connection.commit()    cursor.close()    connection.close()@bot.message_handler(commands=['help'])def help(message):    print('User {id} press help'.format(id=message.chat.id))    bot.send_message(message.chat.id, helps())def helps():    ans = '/start - registration\n'    ans += '/help - output of all commands\n'    ans += '/settings - edit profile'    return ans@bot.message_handler(commands=['settings'])def settings(message):    print('User {id} press settings'.format(id=message.chat.id))    connection = sqlite3.connect("person.dp")    cursor = connection.cursor()    cursor.execute("SELECT id, name FROM info WHERE id = ?", (message.chat.id,))    exist = cursor.fetchone()    if exist:        bot.send_message(message.chat.id, 'Your name: {name}'.format(name=exist[1]))    else:        bot.send_message(message.chat.id, 'I do not know you, please register')@bot.message_handler(regexp="Hello")def handler_message(message):    print('User {id} write {text}'.format(id=message.chat.id, text=message.text))    connection = sqlite3.connect("person.dp")    cursor = connection.cursor()    cursor.execute("SELECT id, name FROM info WHERE id = ?", (message.chat.id,))    exist = cursor.fetchone()    if exist:        bot.send_message(message.chat.id, 'Hello, {name}. I am glad to see you.'.format(name=exist[1]))    else:        bot.send_message(message.chat.id, 'I do not know you, please register')@bot.message_handler(regexp='')def handler_message(message):    print('User {id} write {text}'.format(id=message.chat.id, text=message.text))    bot.send_message(message.chat.id, 'I do not understand you')bot.polling()# cursor.execute("SELECT id, name FROM info WHERE id = ?", (message.chat.id,))# exist = cursor.fetchone()# print(exist)# cursor.execute("UPDATE info SET name = ? WHERE id = ?", (message.text, message.chat.id))# print('{old} name changed : {name}'.format(old=exist[1], name=message.text))# bot.send_message(message.chat.id, 'Name changed!')